  5 COPY   START  0
 10 FIRST  STL    RETADR
 12        LDB    #LENGTH
 13        BASE   LENGTH
 15 CLOOP  +JSUB  RDREC
 20        LDA    LENGTH
 25        COMP   #0
 30        JEQ    ENDFIL
 35        +JSUB  WRREC
 40        J      CLOOP
 45 ENDFIL LDA    EOF
 50        STA    BUFFER
 55        LDA    #3
 60        STA    LENGTH
 65        +JSUB  WRREC
 70        J      @RETADR
 80 EOF    BYTE   C'EOF'
 95 RETADR RESW   1
100 LENGTH RESW   1
105 BUFFER RESB   4096
110 .
115 .      SUBROUTINE TO READ RECORD INTO BUFFER
120 .
125 RDREC  CLEAR  X
130        CLEAR  A
132        CLEAR  S
133        +LDT   #4096
135 RLOOP  TD     INPUT
140        JEQ    RLOOP
145        RD     INPUT
150        COMPR  A, S
155        JEQ    EXIT
160        STCH   BUFFER, X
165        TIXR   T
170        JLT    RLOOP
175 EXIT   STX    LENGTH
180        RSUB
185 INPUT  BYTE   X'F1'
195 .
200 .      SUBROUTINE TO WRITE RECORD FROM BUFFER
205 .
210 WRREC  CLEAR  X
212        LDT    LENGTH
215 WLOOP  TD     OUTPUT
220        JEQ    WLOOP
225        LDCH   BUFFER, X
230        WD     OUTPUT
235        TIXR   T
240        JLT    WLOOP
245        RSUB
250 OUTPUT BYTE   X'05'
255        END    FIRST

